0000              ; LED animation demo to run with the ByteMachine main board.
0000              
0000              ; address space layout
0000              ROM = $0000
0000              RAM = $8000
0000              COUNTER = $8001
0000              DUMMY = $8002
0000              
0000              
0000                  ORG $0000
0000              MAIN:
0000                  ; init memory location COUNTER with 0
0000 b0 80            SET R0 ^RAM
0002 a0               DP R0
0003 b0 01            SET R0 .COUNTER
0005 b1 00            SET R1 0
0007 d1               ST R1 R0
0008                  ; test initial jump instruction
0008 b0 0d            SET R0 .LOOP
000a b1 00            SET R1 ^LOOP
000c 94               JMP R0 R1
000d              
000d              LOOP:
000d                  ; increment COUNTER up to 15 and then wrap back to 0
000d b0 01            SET R0 .COUNTER
000f c2               LD R2 R0
0010 b1 01            SET R1 1
0012 16               ADD R2 R1
0013 b1 0f            SET R1 15
0015 56               AND R2 R1
0016 d2               ST R2 R0
0017              
0017                  ; fetch pattern from ROM
0017 b3 00            SET R3 ^PATTERN
0019 ac               DP R3
001a b1 3b            SET R1 .PATTERN
001c 16               ADD R2 R1
001d ca               LD R2 R2
001e              
001e                  ; write pattern to ROM range to hit the output port
001e d6               ST R2 R1
001f              
001f                  ; switch back to RAM address and RAM mode also
001f b0 80            SET R0 ^RAM
0021 a0               DP R0
0022 b1 02            SET R1 .DUMMY
0024 d4               ST R0 R1
0025              
0025                  ; delay loop
0025 b3 01            SET R3 1
0027 b0 1e            SET R0 30
0029              L1:
0029 b1 64            SET R1 100
002b              L2:
002b b2 64            SET R2 100
002d              L3 :
002d 2e               SUB R2 R3
002e 8b 2d            BGE R2 R3 .L3
0030 2d               SUB R1 R3
0031 87 2b            BGE R1 R3 .L2
0033 2c               SUB R0 R3
0034 83 29            BGE R0 R3 .L1
0036              
0036                  ; start over
0036 b0 0d            SET R0 .LOOP
0038 b1 00            SET R1 ^LOOP
003a 94               JMP R0 R1
003b              
003b              PATTERN:
003b 80 c0 60 30      BYTE $80 $C0 $60 $30 $18 $0C $06 $03
003f 18 0c 06 03 
0043 01 03 06 0c      BYTE $01 $03 $06 $0C $18 $30 $60 $C0
0047 18 30 60 c0 
